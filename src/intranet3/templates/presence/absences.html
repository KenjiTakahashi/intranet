{% extends "templates/_base.html" %}

{% block content %}
{% set may_days = 31 %}
{% set june_days = 30 %}
{% set july_days = 30 %}
{% set may_holidays = [1,3,4,5,11,12,18,19,25,26,30] %}
{% set june_holidays = [1,2,8,9,15,16,22,23,29,30] %}
{% set july_holidays = [6,7,13,14,20,21,27,28] %}
<div class="absences">
    <table cellpadding="0" cellspacing="0" border="0" class="display" id="example1">
        <thead>
            <tr>
                <th rowspan="3" class="user">User</th>
                <th rowspan="1" class="month" colspan="{{ may_days }}">Maj</th>
                <th rowspan="1" class="month" colspan="{{ june_days }}">Czerwiec</th>
                <th rowspan="1" class="month" colspan="{{ july_days }}">Czerwiec</th>
            </tr>
            <tr>
                {% for i in range(1, may_days+1) %}
                    <th class="day{% if loop.last %} monthend{% endif %}{% if i in may_holidays %} holiday{% endif %}">{{ i }}</th>
                {% endfor %}
                {% for i in range(1, june_days+1) %}
                    <th class="day{% if loop.last %} monthend{% endif %}{% if i in june_holidays %} holiday{% endif %}">{{ i }}</th>
                {% endfor %}
                {% for i in range(1, july_days+1) %}
                    <th class="day{% if loop.last %} monthend{% endif %}{% if i in july_holidays %} holiday{% endif %}">{{ i }}</th>
                {% endfor %}
            </tr>
            <tr>
                {% for i in range(1, may_days+1) %}
                    <th class="weekday{% if loop.last %} monthend{% endif %}{% if i in may_holidays %} holiday{% endif %}">{{ loop.cycle(*may_weekdays) }}</th>
                {% endfor %}
                {% for i in range(1, june_days+1) %}
                    <th class="weekday{% if loop.last %} monthend{% endif %}{% if i in june_holidays %} holiday{% endif %}">{{ loop.cycle(*june_weekdays) }}</th>
                {% endfor %}
                {% for i in range(1, july_days+1) %}
                    <th class="weekday{% if loop.last %} monthend{% endif %}{% if i in july_holidays %} holiday{% endif %}">{{ loop.cycle(*july_weekdays) }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% for user in users %}
            <tr>
                <td class="user">{{ user.name }}</td>
                {% for i in range(1, may_days+1) %}
                    <td class="{% if loop.last %}monthend{% endif %}{% if i in may_holidays %} holiday{% endif %}"></td>
                {% endfor %}
                {% for i in range(1, june_days+1) %}
                    <td class="{% if loop.last %}monthend{% endif %}{% if i in june_holidays %} holiday{% endif %}"></td>
                {% endfor %}
                {% for i in range(1, july_days+1) %}
                    <td class="{% if loop.last %}monthend{% endif %}{% if i in july_holidays %} holiday{% endif %}"></td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock content %}

{% block headstyle_block %}
    <link rel="stylesheet" type="text/css" href="{{ request.static_path('intranet3:static/css/jquery.dataTables.css') }}" />
{% endblock %}

{% block tail_script %}
    <script src="{{ request.static_path('intranet3:static/js/vendor/jquery.dataTables.js') }}"></script>
    <script src="{{ request.static_path('intranet3:static/js/vendor/FixedColumns.js') }}"></script>
    <script>
    $(document).ready( function () {
        var days = 91;
        var tableScrollXInner = 20 * days;
        var sScrollXInner = tableScrollXInner + 'px';
        console.log(sScrollXInner);
        var oTable = $('#example1').dataTable( {
            "sScrollY": "500px",
            "sScrollX": "100%",
            "sScrollXInner": sScrollXInner,
            "bScrollCollapse": true,
            "bPaginate": false,
            "bSort": false,
            "bAutoWidth": false,
            "aoColumnDefs": [
                { "sWidth": "20px", "aTargets": ['day', 'weekday'] }
            ]
        } );
        new FixedColumns( oTable, {"iLeftWidth": 150});
        setTimeout(function (){
            oTable.fnAdjustColumnSizing();
        }, 10 );
        /*
        http://www.datatables.net/examples/api/highlight.html
        $('td', oTable.fnGetNodes()).hover(
            function() {
                var iCol = $('td').index(this) % 33;
                var nTrs = oTable.fnGetNodes();
                $('td:nth-child('+(iCol+1)+')', nTrs).addClass( 'highlighted' );
            },
            function() {
                $('td.highlighted', oTable.fnGetNodes()).removeClass('highlighted');
            }
        );
        */
    });
    </script>
{% endblock %}
